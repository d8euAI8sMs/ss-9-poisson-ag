\documentclass[12pt,a4paper]{article}
\usepackage{russ}
\usepackage[english,russian]{babel}
\usepackage{microtype}
\usepackage{csquotes}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{mathtext}
\usepackage[notrig,italicdiff]{physics}
\usepackage{newfloat}
\usepackage{caption}
\usepackage{indentfirst}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{mdframed}
\usepackage[inline]{enumitem}
\usepackage{graphicx}
\usepackage{subfig}
\geometry{left=1cm,right=1cm,top=2cm,bottom=2cm}
\DeclareGraphicsExtensions{.pdf,.png,.jpg,.PNG}
\graphicspath{{./img/}}
\captionsetup[figure]{justification=centering}
\renewcommand{\thesubfigure}{\asbuk{subfigure}}
\DeclareCaptionLabelSeparator{dotseparator}{. }
\captionsetup{labelsep=dotseparator}

\begin{document}

    %
    %
    %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %                           SECTION                                   %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %
    %
    %

    \section{Постановка задачи}

        Найти распределение электрического поля в системе из двух металлических тел в форме подковообразных магнитов, помещенных в заземленную металлическую клетку, полюса которых изолированы друг от друга и могут иметь произвольные заряды.

    %
    %
    %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %                           SECTION                                   %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %
    %
    %

    \section{Физическая модель}

        Будем считать, что пространство клетки заполнено воздухом. Металлические тела будем считать идеальными. Нас интересует решение поставленной задачи внутри клетки.

    %
    %
    %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %                           SECTION                                   %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %
    %
    %

    \section{Математическая модель}

        %
        %
        %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %                        SUBSECTION                               %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %
        %
        %

        \subsection{Уравнение Пуассона}

            Уравнение Пуассона имеет вид:
            %
            \begin{equation}\label{eq:poisson_eq}
                \Delta\varphi(\vb{r})
                    = - \frac{\rho(\vb{r})}{\varepsilon_0} ,
            \end{equation}
            %
            где $\rho(\vb{r})$~--- плотность заряда, $\varepsilon_0$~--- универсальная диэлектрическая постоянная.

            На внешней поверхности металла потенциал одинаков и определяется по теореме Гаусса:
            %
            \begin{equation}
                \oint\limits_{\partial\Omega} \vb{E} \dd{\vb{S}}
                    = \frac{1}{\varepsilon_0} \int\limits_\Omega \rho \dd{\Omega}
                    = \frac{q_\Omega}{\varepsilon_0} ,
            \end{equation}
            %
            где $\Omega$~--- область пространства (в т.ч. многосвязная), занимаемая телом, $\partial\Omega$~--- внешняя граница этой области.

        %
        %
        %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %                        SUBSECTION                               %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %
        %
        %

        \subsection{Выбор единиц измерения}

            Произведем замену переменных по правилу:
            %
            \begin{equation}
                \rho \mapsto \varepsilon_0 \rho.
            \end{equation}
            %
            Уравнение Пуассона (\autoref{eq:poisson_eq}) при этом примет вид:
            %
            \begin{equation}\label{eq:poisson_eq_dimless}
                \Delta\varphi(\vb{r}) = - \rho(\vb{r}),
            \end{equation}

    %
    %
    %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %                           SECTION                                   %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %
    %
    %

    \section{Численная модель}

        %
        %
        %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %                        SUBSECTION                               %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %
        %
        %

        \subsection{Дискретная модель}

            Поскольку геометрия задачи не является тривиальной, построим наиболее подходящую задаче сетку узлов и проведем триангуляцию Делоне. Область моделирования обозначим $D$, множество всех узлов сетки~--- $V = \qty{ v_i \ |\  v_i = (x_i, y_i) \in D }$, множество всех треугольников~--- $T$, множество всех треугольников, соседних к $i$-му узлу~--- $T_i \subseteq T$. Теми же буквами будем обозначать множества индексов узлов (треугольников), т.е. запись $i \in V$ эквивалентна записи $v_i \in V$.

        %
        %
        %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %                        SUBSECTION                               %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %
        %
        %

        \subsection{Метод конечных элементов}

            Опишем метод конечных элементов в формулировке Галеркина.

            Выберем некоторый функциональный базис $\Phi = \qty{ \phi_i(x,y) \ |\ (x,y) \in D }$. Решение задачи будем искать в классе функций $f_\Phi(x,y)$, порожденных базисом $\Phi$:
            %
            \begin{equation}
                f_{\Phi}(x,y) = \sum\limits_{i\in\Phi} c_i \phi_i .
            \end{equation}

            Таким образом, в \autoref{eq:poisson_eq_dimless} под $\varphi(x,y)$ будем подразумевать $\varphi_\Phi(x,y)$, а под $\rho(x,y)$~--- $\rho_\Phi(x,y)$.

            Согласно Галеркину, неизвестные коэффициенты $c_i$ могут быть найдены следующим путем. Рассмотрим невязку
            %
            \begin{equation}
                R(x,y) = \Delta\varphi(x,y) - \rho(x,y) .
            \end{equation}
            %
            Если $\varphi(x,y)$~--- решение задачи, то невязка $R(x,y) = 0 \ \forall (x,y) \in D$. Поскольку базис $\Phi$ является полным для функций класса $f_\Phi(x,y)$, этому требованию можно удовлетворить, затребовав
            %
            \begin{equation}\label{eq:rdotphi}
                \braket{R}{\phi_i} = 0 \ \forall i \in \Phi ,
            \end{equation}
            %
            где за $\braket{\cdot}$ обозначено скалярное произведение функций на области $D$:
            %
            \begin{equation}
                \braket{f}{g} = \iint\limits_D f(x,y) g(x,y) \dd{S}.
            \end{equation}
            %
            Если теперь раскрыть \autoref{eq:rdotphi} явно, получим
            %
            \begin{equation}\label{eq:sle}
                \sum\limits_{j\in\Phi}
                    c_j \braket{\Delta\phi_j}{\phi_i} -
                        \braket{\rho}{\phi_i} = 0 \ \forall i \in \Phi .
            \end{equation}
            %
            Полученное выражение~--- система линейных уравнений относительно неизвестных $c_j$. Она может быть решена матричными или другими методами решения СЛУ.

        %
        %
        %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %                        SUBSECTION                               %
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
        %
        %
        %

        \subsection{Кусочно-линейный базис}

            Обычно в качестве базиса $\Phi$ выбирают элементный базис, в котором функции $\phi_i$ равны единице в соответствующих точках $v_i$ и спадают до нуля на границе области $D_i \subset D$, ограниченной соседними треугольниками $t_k \in T_i$ узла $v_i$. Это позволяет легко учитывать граничные условия. Так, граничное условие Дирихле в узле $v_i$ задается через значение коэффициента $c_i$ при члене $\phi_i$ в разложении $\varphi$ по базису $\Phi$.

            При наличии граничных условий Дирихле не все коэффициенты $c_i$ являются неизвестными, поэтому в \autoref{eq:rdotphi} взятие скалярных произведений на базисные функции, соответствующие известным коэффициентам, является излишним.

            Матрица коэффициентов при векторе неизвестных $c_i$ в случае элементного базиса сильно разрежена. В связи с этим не целесообразно применять прямые матричные методы (особенно метод псевдообратной матрицы) для нахождения значений коэффициентов $c_i$. Наиболее оптимальным видится метод Качмаржа, который не требует загрузки в память сразу всей матрицы, а также позволяет оптимизацию структуры матрицы на уровне строк (хранение только ненулевых элементов строки).

            Наиболее простым элементным базисом является кусочно-линейный базис. Базисные функции $\phi_i$ в нем представляют собой пирамидки с вершиной в точке $v_i$, где значение функции $\phi_i(v_i) = 1$. Основание пирамидки~--- область $D_i$, образованная соседними к узлу $v_i$ треугольниками. Вне и на границе области $D_i$ базисная функция $\phi_i$ обращается в нуль.

            В случае элементного базиса \autoref{eq:sle} позволяет дополнительные упрощения. Распишем скалярное произведение $\braket{\Delta\phi_j}{\phi_i}$ по теореме Гаусса:
            %
            \begin{equation}\begin{aligned}
                \braket{\Delta\phi_j}{\phi_i}
                    &= \iint\limits_D \Delta\phi_j \phi_i \dd{S} \\
                    &= \iint\limits_{\partial D} \nabla\phi_j \phi_i \dd{\vb{l}} -
                       \iint\limits_D \nabla\phi_j \nabla\phi_i \dd{S} .
            \end{aligned}\end{equation}
            %
            Предпоследний интеграл обращается в нуль, поскольку $\phi_j(\partial D) = 0$.

            Для кусочно-линейного базиса $\nabla\phi_i = \text{const}$, поэтому последний интеграл сводится к суммированию площадей \enquote{общих} треугольников областей $D_i$ и $D_j$, помноженных на константы.

            При ненулевом $\rho$ возникает также необходимость нахождения $\braket{\rho}{\phi_i}$. Как и раньше, разложим $\rho$ по базису $\Phi$ и рассмотрим скалярные произведения вида $\braket{\phi_j}{\phi_i}$. Интегрирование необходимо проводить по площадям треугольников, общих для областей $D_i$ и $D_j$. Сложность такого интегрирования в явном виде в силу произвольности треугольных областей, несомненно, велика, но ее можно уменьшить, произведя замену системы координат. Само же интегрирование после замены координат не представляет сложности.

            Пусть требуется найти
            %
            \begin{equation}
                \iint\limits_{\bigtriangleup ABC} f(x,y) \dd{S}
            \end{equation}
            %
            и пусть $\vb{a}$, $\vb{b}$ и $\vb{c}$~--- радиусы-векторы точек треугольника $ABC$. Произведем замену координат $(x,y) \mapsto (u,v)$ по правилу:
            %
            \begin{equation}
                (x,y) = \vb{a} + u (\vb{b} - \vb{a}) + v (\vb{c} - \vb{a}) .
            \end{equation}
            %
            Тогда
            %
            \begin{equation}
                \iint\limits_{\bigtriangleup ABC} f(x,y) \dd{S}
                    = \int\limits_0^1 \int\limits_0^{1-u}
                        f(x(u,v),y(u,v)) \qty|J_{xyuv}| \dd{u}\dd{v} ,
            \end{equation}
            %
            где $J_{xyuv} = \qty|\qty[(\vb{b} - \vb{a}) \times (\vb{c} - \vb{a})]| = 2 S_{ABC}$~--- якобиан преобразования координат.

    %
    %
    %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %                           SECTION                                   %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %
    %
    %

    \section{Анализ результатов}

        В ходе работы была написана демонстрационная программа (\autoref{fig:mainwindow}) на языке  \enquote{C++}, позволяющая исследовать вид электростатического поля в зависимости от конфигурации системы.
        %
        \begin{figure}[h]
            \centering
            \includegraphics[width=0.8\textwidth]{mainwindow}
            \caption[]{Главное окно программы}
            \label{fig:mainwindow}
        \end{figure}
        %
        Программа строит эквипотенциальные и силовые линии поля по рассчитанным значениям потенциала на каждой итерации.

        На \autoref{fig:case_1}-\autoref{fig:case_4} приведены результаты моделирования для различных конфигураций системы.
        %
        \begin{figure}[!htb]%
            \centering
            %
            \subfloat[][]{%
                \label{fig:iso_1}%
                \includegraphics[width=0.45\textwidth]{iso_1}}%
            \hspace{8pt}%
            %
            \subfloat[][]{%
                \label{fig:field_1}%
                \includegraphics[width=0.45\textwidth]{field_1}}%
            \hspace{8pt}%
            %
            \caption[]{Эквипотенциальные \subref{fig:iso_1} и силовые \subref{fig:field_1} линии. Тела заряжены разноименными зарядами}%
            \label{fig:case_1}%
        \end{figure}
        %
        \begin{figure}[!htb]%
            \centering
            %
            \subfloat[][]{%
                \label{fig:iso_2}%
                \includegraphics[width=0.45\textwidth]{iso_2}}%
            \hspace{8pt}%
            %
            \subfloat[][]{%
                \label{fig:field_2}%
                \includegraphics[width=0.45\textwidth]{field_2}}%
            \hspace{8pt}%
            %
            \caption[]{Эквипотенциальные \subref{fig:iso_2} и силовые \subref{fig:field_2} линии. Полюса \enquote{магнитов} заряжены разноименными зарядами. Северный полюс первого магнита заряжен так же, как южный полюс второго мангита}%
            \label{fig:case_2}%
        \end{figure}
        %
        \begin{figure}[!htb]%
            \centering
            %
            \subfloat[][]{%
                \label{fig:iso_3}%
                \includegraphics[width=0.45\textwidth]{iso_3}}%
            \hspace{8pt}%
            %
            \subfloat[][]{%
                \label{fig:field_3}%
                \includegraphics[width=0.45\textwidth]{field_3}}%
            \hspace{8pt}%
            %
            \caption[]{Эквипотенциальные \subref{fig:iso_3} и силовые \subref{fig:field_3} линии. Полюса \enquote{магнитов} заряжены разноименными зарядами. Северный полюс первого магнита заряжен так же, как северный полюс второго мангита}%
            \label{fig:case_3}%
        \end{figure}
        %
        \begin{figure}[!htb]%
            \centering
            %
            \subfloat[][]{%
                \label{fig:iso_4}%
                \includegraphics[width=0.45\textwidth]{iso_4}}%
            \hspace{8pt}%
            %
            \subfloat[][]{%
                \label{fig:field_4}%
                \includegraphics[width=0.45\textwidth]{field_4}}%
            \hspace{8pt}%
            %
            \caption[]{Эквипотенциальные \subref{fig:iso_4} и силовые \subref{fig:field_4} линии. Тела ориентированы произвольно. Полюса \enquote{магнитов} заряжены разноименными зарядами. Северный полюс первого магнита заряжен так же, как северный полюс второго мангита}%
            \label{fig:case_4}%
        \end{figure}

    %
    %
    %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %                           SECTION                                   %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %
    %
    %

    \section{Выводы}

        В ходе работы была написана демонстрационная программа, позволяющая исследовать вид электростатического поля в зависимости от конфигурации рассматриваемой системы.

        Результаты моделирования классических случаев совпадают с ожидаемыми.

\end{document}
